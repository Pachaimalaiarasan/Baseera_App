<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Manage Service Plans</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <style>
    body {
      margin: 0;
      background: #faf3fc;
      font-family: 'Segoe UI', Arial, sans-serif;
    }

    .header {
      background: #199af5;
      padding: 18px 0 12px 0;
      color: #fff;
      font-size: 22px;
      font-weight: 700;
      text-align: center;
      position: relative;
    }

    .header .back-btn {
      position: absolute;
      left: 18px;
      top: 16px;
      font-size: 23px;
      background: none;
      border: none;
      color: #fff;
      cursor: pointer;
    }

    .container {
      max-width: 440px;
      margin: 23px auto 0 auto;
      background: none;
      padding: 0 14px;
    }

    .section-title {
      font-weight: bold;
      font-size: 25px;
      color: #1b1d29;
      margin: 14px 0 20px 0;
    }

    .input-wrap {
      display: flex;
      align-items: center;
      background: #fff;
      border-radius: 13px;
      box-shadow: 0 2px 8px #d3e9fd22;
      border: 1.8px solid #e0ecfd;
      margin-bottom: 18px;
      padding: 0 8px;
    }

    .input-wrap svg {
      width: 24px;
      height: 24px;
      fill: #70b6f7;
      margin-right: 4px;
    }

    .input-wrap input {
      border: none;
      outline: none;
      background: transparent;
      padding: 15px 0;
      width: 100%;
      font-size: 17px;
      color: #252d46;
    }

    .add-btn {
      width: 100%;
      border: none;
      border-radius: 20px;
      background: #2196f3;
      color: #fff;
      font-size: 18px;
      font-weight: 600;
      padding: 13px 0;
      margin-top: 14px;
      margin-bottom: 11px;
      box-shadow: 0 4px 20px #51c8ff22;
      cursor: pointer;
      transition: background 0.19s;
    }

    .add-btn:hover {
      background: #0c84db;
    }

    .plans-section-title {
      font-size: 21px;
      color: #222;
      font-weight: 600;
      margin: 27px 0 13px 0;
    }

    .plan-card {
      display: flex;
      align-items: center;
      background: #fff;
      border-radius: 18px;
      padding: 17px 16px 13px 16px;
      margin-bottom: 15px;
      box-shadow: 0 2px 14px #e3f2fd44;
      border: 1.5px solid #e4eaf3;
    }

    .plan-icon {
      width: 33px;
      height: 33px;
      border-radius: 9px;
      background: #dcf3fa;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-right: 12px;
    }

    .plan-icon svg {
      width: 27px;
      height: 27px;
      fill: #0896ad;
    }

    .plan-info {
      flex: 1;
    }

    .plan-label {
      font-size: 18px;
      color: #223550;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .plan-price {
      color: #444;
      font-size: 16px;
      margin-bottom: 1px;
    }

    .plan-actions button {
      background: none;
      border: none;
      padding: 0 4px;
      font-size: 21px;
      cursor: pointer;
      outline: none;
    }

    .plan-actions .edit {
      color: #FFA726;
    }

    .plan-actions .delete {
      color: #E53935;
    }

    .hint {
      color: #aab3cb;
      margin: 12px 0 11px 0;
      font-size: 16px;
      text-align: center;
    }
  </style>
</head>

<body>
  <div class="header">
    <button class="back-btn" onclick="window.history.back()">&#8592;</button>
    Manage Service Plans
  </div>
  <div class="container">
    <div class="section-title">Add New Plan</div>
    <div class="input-wrap">
      <svg>
        <use href="#icon-gift" />
      </svg>
      <input id="planName" placeholder="Plan Name" autocomplete="off" />
    </div>
    <div class="input-wrap">
      <svg>
        <use href="#icon-money" />
      </svg>
      <input id="planPrice" placeholder="Pricing" type="number" autocomplete="off" />
    </div>
    <button class="add-btn" onclick="addPlan()">Add Plan</button>
    <div class="plans-section-title">Added Plans</div>
    <div id="plansList"></div>
  </div>
  <!-- SVG Icons -->
  <svg style="display:none">
    <symbol id="icon-gift" viewBox="0 0 24 24">
      <path
        d="M20 7h-2.18A3.004 3.004 0 0012 6.34 3.006 3.006 0 006.18 7H4a2 2 0 00-2 2v3c0 .55.45 1 1 1h1v9c0 .55.45 1 1 1h12a1 1 0 001-1v-9h1a1 1 0 001-1V9a2 2 0 00-2-2zm-8-2c0-.55.45-1 1-1s1 .45 1 1a1 1 0 01-2 0zM4 9h2.18a2.977 2.977 0 00.99-.17C7.07 8.79 7 8.4 7 8c0-.55.45-1 1-1s1 .45 1 1c0 .4-.07.79-.17 1.17A2.977 2.977 0 008.18 9H4V9zm10 13h-4v-7h4v7zm6-10h-2.18a2.977 2.977 0 00-.99.17c.1-.38.17-.77.17-1.17 0-.55-.45-1-1-1s-1 .45-1 1c0 .4.07.79.17 1.17A2.977 2.977 0 0015.82 12H20v-1z" />
    </symbol>
    <symbol id="icon-money" viewBox="0 0 24 24">
      <path
        d="M17 5V3a1 1 0 10-2 0v2H9V3A1 1 0 107 3v2H6a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1zm2 2v2H5V7h14zm0 10H5V9h14v8zm-7 0a1 1 0 112 0 1 1 0 01-2 0z" />
    </symbol>
  </svg>
  <script>
    // --- Parse service id from URL ---
    function getServiceId() {
      const params = new URLSearchParams(window.location.search);
      return params.get('service_id');
    }
    const serviceId = getServiceId();
    if (!serviceId) {
      document.body.innerHTML = '<div class="hint">No service selected.<br>Please open this page from a service card.</div>';
      throw new Error("No service_id provided");
    }

    function addPlan() {
      const planName = document.getElementById('planName').value.trim();
      const planPrice = document.getElementById('planPrice').value.trim();
      if (!planName || !planPrice) {
        Swal.fire({
          icon: 'warning',
          title: 'Delete',
          text: "fill that all fileds"
        }); return;
      }
      const fd = new FormData();
      fd.append('service_id', serviceId);
      fd.append('plan_name', planName);
      fd.append('plan_price', planPrice);
      fetch('../Backend/add_service_plan.php', { method: 'POST', body: fd })
        .then(r => r.json())
        .then(d => {
          if (d.status === 'success') {
            loadPlans();
            document.getElementById('planName').value = '';
            document.getElementById('planPrice').value = '';
          } else {
            Swal.fire({
              icon: 'error',
              title: 'Faild',
              text: "Add Plan Faild."
            });
          }
        });
    }

    function loadPlans() {
      fetch('../Backend/get_service_plans.php?service_id=' + serviceId)
        .then(r => r.json())
        .then(d => {
          const list = document.getElementById('plansList');
          if (d.status === "success" && Array.isArray(d.plans)) {
            if (d.plans.length === 0) {
              list.innerHTML = `<div class="hint">No plans added yet for this service.</div>`;
            } else {
              list.innerHTML = d.plans.map(p => `
                <div class="plan-card">
                  <div class="plan-icon">
                    <svg><use href="#icon-gift"/></svg>
                  </div>
                  <div class="plan-info">
                    <div class="plan-label">${p.plan_name}</div>
                    <div class="plan-price">Price: $${parseFloat(p.plan_price).toFixed(2)}</div>
                  </div>
                  <div class="plan-actions">
                    <!--<button class="edit" title="Edit (Coming Soon)">‚úèÔ∏è</button>-->
                    <button class="delete" title="Delete" onclick="deletePlan(${p.plan_id})">üóëÔ∏è</button>
                  </div>
                </div>
              `).join('');
            }
          } else {
            list.innerHTML = `<div class="hint" style="color:#e53935;">Could not load plans.</div>`;
          }
        });
    }

    function deletePlan(planId) {
      if (!confirm("Delete this plan?")) return;
      fetch('../Backend/delete_serviceplan.php', {
        method: 'POST',
        body: new URLSearchParams({ plan_id: planId })
      }).then(r => r.json()).then(d => {
        if (d.status === "success") loadPlans();
        Swal.fire({
          icon: 'error',
          title: 'Delete',
          text: "Could not delete ."
        });
      });
    }

    // Initial load
    window.onload = loadPlans;
  </script>
</body>

</html>