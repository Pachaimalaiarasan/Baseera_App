<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Customers</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin: 0; background: #f7f5fd;
  font-family: 'Segoe UI', Arial, sans-serif;
}
.header-bar {
  background: #fff;
  box-shadow: 0 2px 7px rgba(100,90,170,0.04);
  border-bottom-left-radius: 20px;
  border-bottom-right-radius: 20px;
  padding: 23px 0 16px 0;
  text-align: center;
  position: sticky; top: 0; z-index: 3;
}
.header-bar h2 {
  font-size: 1.8rem;
  font-weight: 700;
  color: #351a60;
  margin: 0 0 3px 0;
  letter-spacing: 1px;
}
.search-box {
  display: flex; align-items: center;
  background: #f2effb;
  padding: 9px 13px;
  border-radius: 13px;
  max-width: 390px;
  margin: 10px auto 0 auto;
  box-shadow: 0 2px 10px rgba(110,95,200,0.08);
  border: 1.2px solid #eeeaf8;
}
.search-box input {
  border: none;
  outline: none;
  flex: 1;
  background: transparent;
  font-size: 1.07rem;
  color: #372276;
  margin-left: 7px;
}
.search-box .icon {
  color: #857ce9;
  font-size: 1.2em;
}
.customers-list {
  max-width: 470px;
  margin: 0 auto;
  margin-top: 14px;
  padding-bottom: 25px;
}
.customer-card {
  display: flex;
  align-items: center;
  background: #fff;
  border-radius: 15px;
  box-shadow: 0 3px 16px rgba(54,27,113,.06);
  padding: 15px 15px 15px 13px;
  margin-bottom: 15px;
  transition: box-shadow .11s;
}
.customer-avatar {
  width: 46px; height:46px;
  font-size: 1.6rem;
  background: linear-gradient(120deg, #a979ec 70%, #7191ea 120%);
  border-radius: 50%;
  color: #fff;
  display: flex; align-items: center; justify-content: center;
  font-weight: 600;
  flex-shrink: 0;
  margin-right: 16px;
  box-shadow: 0 1.5px 11px 0 rgba(90,60,170,0.10);
}
.customer-info {
  flex: 1;
  min-width: 0;
}
.customer-name {
  font-size: 1.12rem;
  font-weight: 600;
  color: #352364;
  margin-bottom: 6px;
  line-height: 1.02;
  text-overflow: ellipsis;
  white-space: nowrap; overflow: hidden;
}
.customer-id {
  font-size: 0.96rem;
  color: #917ed7;
  font-weight: 400;
  line-height: 1;
}
@media (max-width: 620px) {
  .header-bar h2 { font-size:1.22rem;}
  .customers-list {max-width:99vw;}
  .customer-card{padding:11px 7px 11px 7px;}
  .customer-avatar{width:40px;height:40px;font-size:1.25rem;}
}
</style>
</head>
<body>
  <div class="header-bar">
    <h2>Customers</h2>
    <div class="search-box">
      <span class="icon">&#128269;</span>
      <input id="customer-search" type="text" placeholder="Search customers..." oninput="searchCustomers()" autocomplete="off">
    </div>
  </div>
  <div id="customers-list" class="customers-list"></div>

<script>
let allCustomers = [];

document.addEventListener("DOMContentLoaded", function() {
  fetch('../Backend/get_customers.php')
  .then(res => res.json())
  .then(data => {
    if(data.status==="success" && Array.isArray(data.customers)){
      allCustomers = data.customers;
      renderCustomers(allCustomers);
    } else {
      document.getElementById('customers-list').innerHTML = '<div style="color:#b55;margin:22px;text-align:center;">Failed to load customers.</div>';
    }
  })
  .catch(()=>{
    document.getElementById('customers-list').innerHTML = '<div style="color:#b55;margin:22px;text-align:center;">Network error loading customers.</div>';
  });
});

function renderCustomers(customers){
  let html = "";
  if(!customers.length){
    html = '<div style="text-align:center;padding:28px;color:#afaddf;">No customers found.</div>';
  }
  customers.forEach(cust=>{
    let initials = getInitials(cust.customer_name || "") || "#";
    html += `
      <div class="customer-card">
        <div class="customer-avatar">${initials}</div>
        <div class="customer-info">
          <div class="customer-name">${escapeHtml(cust.customer_name || "")}</div>
          <div class="customer-id">ID: ${cust.customer_id}</div>
        </div>
      </div>
    `;
  });
  document.getElementById('customers-list').innerHTML = html;
}

// Live search by name or id
function searchCustomers(){
  const query = document.getElementById('customer-search').value.trim().toLowerCase();
  if(query===""){
    renderCustomers(allCustomers);
    return;
  }
  const filtered = allCustomers.filter(cust=>{
    return (
      (cust.customer_name && cust.customer_name.toLowerCase().includes(query)) ||
      (cust.customer_id && String(cust.customer_id).includes(query))
    );
  });
  renderCustomers(filtered);
}

// Helpers
function getInitials(name){
  name = name.trim();
  if(!name) return "";
  let parts = name.split(' ').filter(Boolean);
  if(parts.length === 1) return parts[0].substring(0,2).toUpperCase();
  return (parts[0][0] + parts[parts.length-1][0]).toUpperCase();
}
function escapeHtml(text){
  return text.replace(/[&<>"'`=\/]/g,function(s){return({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;',"/":'&#47;','=':'&#61;','`':'&#96;'}[s])});
}
</script>
</body>
</html>
